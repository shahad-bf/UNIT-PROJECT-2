{% extends 'main/base.html' %}
{% load static %}

{% block title %}Check Appointment Status - MediConsult{% endblock %}

{% block content %}
<div style="padding: 20px; max-width: 800px; margin: 0 auto;">
  <!-- Header -->
  <div style="text-align: center; margin-bottom: 30px;">
    <h2 style="color: var(--text-color); margin-bottom: 10px;">Check Your Appointment Status</h2>
    <p style="color: var(--light-text-color);">Enter your email address to view your appointments and doctor responses</p>
  </div>

  <!-- Search Form -->
  <div style="background: var(--white-color); border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);">
    <form method="post">
      {% csrf_token %}
      <div style="display: flex; gap: 15px; align-items: end;">
        <div style="flex-grow: 1;">
          <label for="email" style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--text-color);">
            <i class="material-symbols-outlined" style="vertical-align: middle; margin-right: 5px;">email</i>
            Your Email Address
          </label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            value="{{ search_email|default:'' }}"
            placeholder="Enter your email address..."
            required
            style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 14px;"
          />
        </div>
        <button 
          type="submit" 
          style="background: var(--primary-color); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; height: fit-content;">
          <i class="material-symbols-outlined">search</i>
          Search
        </button>
      </div>
    </form>
  </div>

  <!-- Results -->
  {% if search_email %}
    {% if appointments %}
      <div style="background: var(--white-color); border-radius: 12px; padding: 20px; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);">
        <h3 style="color: var(--text-color); margin-bottom: 20px; display: flex; align-items: center;">
          <i class="material-symbols-outlined" style="margin-right: 10px;">calendar_month</i>
          Your Appointments ({{ appointments.count }})
        </h3>
        
        {% for appointment in appointments %}
          <div style="border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; margin-bottom: 20px; position: relative;">
            <!-- Status Badge -->
            <div style="position: absolute; top: 15px; right: 15px;">
              <span class="appointment-status appointment-status-{{ appointment.status }}" 
                    style="padding: 6px 12px; border-radius: 15px; font-size: 12px; font-weight: 600; 
                           {% if appointment.status == 'pending' %}background: rgba(245, 158, 11, 0.1);
                           {% elif appointment.status == 'completed' %}background: rgba(16, 185, 129, 0.1);
                           {% elif appointment.status == 'confirmed' %}background: rgba(66, 133, 244, 0.1);
                           {% else %}background: rgba(239, 68, 68, 0.1);{% endif %}">
                {{ appointment.get_status_display }}
              </span>
            </div>

            <!-- Appointment Details -->
            <div style="margin-bottom: 15px;">
              <h4 style="color: var(--text-color); margin-bottom: 10px;">
                Dr. {{ appointment.doctor.user.get_full_name }}
              </h4>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                  <p><strong>Date:</strong> {{ appointment.appointment_date }}</p>
                  <p><strong>Time:</strong> {{ appointment.appointment_time }}</p>
                  <p><strong>Specialty:</strong> {{ appointment.doctor.specialty.name|default:"General Medicine" }}</p>
                </div>
                <div>
                  <p><strong>Booked:</strong> {{ appointment.created_at|date:"M d, Y H:i" }}</p>
                  {% if appointment.response_date %}
                  <p><strong>Response:</strong> {{ appointment.response_date|date:"M d, Y H:i" }}</p>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Doctor Response -->
            {% if appointment.doctor_response %}
              <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-top: 15px;">
                <h5 style="color: #10b981; margin-bottom: 10px; display: flex; align-items: center;">
                  <i class="material-symbols-outlined" style="margin-right: 8px; font-size: 18px;">medical_services</i>
                  Doctor's Response
                </h5>
                <p style="margin: 0; line-height: 1.6; color: #374151;">{{ appointment.doctor_response }}</p>
                <p style="margin-top: 10px; font-size: 12px; color: var(--light-text-color);">
                  Responded on {{ appointment.response_date|date:"M d, Y \a\t H:i" }}
                </p>
              </div>
            {% else %}
              {% if appointment.status == 'pending' %}
                <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-top: 15px;">
                  <p style="margin: 0; color: #92400e; display: flex; align-items: center;">
                    <i class="material-symbols-outlined" style="margin-right: 8px; font-size: 18px;">schedule</i>
                    Waiting for doctor's response...
                  </p>
                </div>
              {% endif %}
            {% endif %}

            <!-- Health Condition (if provided) -->
            {% if appointment.health_condition %}
              <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                <h6 style="color: var(--text-color); margin-bottom: 8px;">Your Health Condition:</h6>
                <p style="color: var(--light-text-color); font-size: 14px; line-height: 1.5;">{{ appointment.health_condition }}</p>
              </div>
            {% endif %}

            <!-- Medical Document -->
            {% if appointment.health_document %}
              <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="material-symbols-outlined" style="color: var(--primary-color);">attach_file</i>
                <a href="{{ appointment.health_document.url }}" target="_blank" 
                   style="color: var(--primary-color); text-decoration: none; font-size: 14px;">
                  View Uploaded Document
                </a>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <!-- No Appointments Found -->
      <div style="background: var(--white-color); border-radius: 12px; padding: 40px; text-align: center; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);">
        <i class="material-symbols-outlined" style="font-size: 64px; color: var(--light-text-color); margin-bottom: 15px;">event_busy</i>
        <h3 style="color: var(--text-color); margin-bottom: 10px;">No Appointments Found</h3>
        <p style="color: var(--light-text-color); margin-bottom: 20px;">
          We couldn't find any appointments for <strong>{{ search_email }}</strong>
        </p>
        <a href="{% url 'main:doctors_list_view' %}" 
           style="background: var(--primary-color); color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
          <i class="material-symbols-outlined">add</i>
          Book an Appointment
        </a>
      </div>
    {% endif %}
  {% else %}
    <!-- Initial State -->
    <div style="background: var(--white-color); border-radius: 12px; padding: 40px; text-align: center; box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);">
      <i class="material-symbols-outlined" style="font-size: 64px; color: var(--primary-color); margin-bottom: 15px;">search</i>
      <h3 style="color: var(--text-color); margin-bottom: 10px;">Enter Your Email</h3>
      <p style="color: var(--light-text-color);">
        Use the form above to search for your appointments and view doctor responses
      </p>
    </div>
  {% endif %}

  <!-- Back to Home -->
  <div style="text-align: center; margin-top: 30px;">
    <a href="{% url 'main:home_view' %}" 
       style="background: var(--dashboard-body-color); color: var(--text-color); padding: 12px 24px; border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
      <i class="material-symbols-outlined">home</i>
      Back to Home
    </a>
  </div>
</div>

<style>
@media (max-width: 768px) {
  div[style*="display: flex; gap: 15px"] {
    flex-direction: column !important;
    gap: 10px !important;
  }
  
  div[style*="grid-template-columns: 1fr 1fr"] {
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
  
  div[style*="position: absolute; top: 15px; right: 15px"] {
    position: static !important;
    margin-bottom: 15px !important;
  }
}
</style>
{% endblock %} 