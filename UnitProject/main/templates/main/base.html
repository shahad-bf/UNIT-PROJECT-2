{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}MediConsult Dashboard{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&family=Poppins:wght@300;400;500;600;700&display=swap">
</head>
<body class="{% block body_class %}{% endblock %}">

  <!-- Sidebar -->
  <aside class="sidebar">
    <header>
      <div class="image-text">
        <div class="logo-text">
          <span class="name">MediConsult</span>
        </div>
      </div>
    </header>
    
    <div class="menu">
      <ul class="menu-link">
        <li><a href="{% url 'main:home_view' %}">
          <i class="material-symbols-outlined">dashboard</i>
          <span class="link-name">Home</span>
        </a></li>

        <li><a href="{% url 'main:doctors_list_view' %}">
          <i class="material-symbols-outlined">groups</i>
          <span class="link-name">Find Doctors</span>
        </a></li>
        
        <li><a href="{% url 'main:my_appointments_view' %}">
          <i class="material-symbols-outlined">event</i>
          <span class="link-name">My Appointments</span>
        </a></li>
        
        <li><a href="{% url 'main:public_medical_records_view' %}">
          <i class="material-symbols-outlined">folder_shared</i>
          <span class="link-name">Medical Records</span>
        </a></li>
        
        <li><a href="{% url 'main:about_view' %}">
          <i class="material-symbols-outlined">info</i>
          <span class="link-name">About</span>
        </a></li>

        <li><a href="{% url 'main:contact_view' %}">
          <i class="material-symbols-outlined">call</i>
          <span class="link-name">Contact</span>
        </a></li>
      </ul>

      <ul class="bottom-menu">        
        <li class="mode">
          <i class="material-symbols-outlined light">light_mode</i>
          <i class="material-symbols-outlined dark" style="opacity: 1;">dark_mode</i>
          <span class="link-name">Dark Mode</span>
          <div class="toggle-switch">
            <span class="switch"></span>
          </div>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Top Header -->
  <header class="top-header">
  </header>

  <!-- Messages -->
  {% if messages %}
    <div style="margin-left: 220px; padding-top: 65px; padding-left: 10px; padding-right: 10px;">
      {% for message in messages %}
        <div style="background: var(--white-color); border-radius: 8px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid var(--primary-color);">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Main -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- Dark Mode Toggle Script -->
  <script>
    const body = document.querySelector('body');
    const modeToggle = document.querySelector('.toggle-switch');
    const modeSection = document.querySelector('.mode');
    const modeText = document.querySelector('.mode .link-name');

    // Function to toggle dark mode
    function toggleDarkMode() {
      body.classList.toggle('dark');
      
      if (body.classList.contains('dark')) {
        localStorage.setItem('darkMode', 'enabled');
      } else {
        localStorage.setItem('darkMode', null);
      }
      
      // Update text after toggle
      updateModeText();
    }

    // Function to update mode text based on current state
    function updateModeText() {
      if (body.classList.contains('dark')) {
        modeText.innerText = 'Dark Mode';
        modeText.style.color = '#ffffff';
      } else {
        modeText.innerText = 'Light Mode';
        modeText.style.color = '';
      }
    }

    // Check for saved dark mode preference on page load
    const savedMode = localStorage.getItem('darkMode');
    if (savedMode === 'enabled') {
      body.classList.add('dark');
    }
    
    // Update text immediately after checking saved mode
    updateModeText();

    // Add click event to both toggle switch and entire mode section
    modeToggle.addEventListener('click', function(e) {
      e.stopPropagation(); // Prevent double triggering
      toggleDarkMode();
    });
    
    modeSection.addEventListener('click', function(e) {
      // Only trigger if not clicking on the toggle switch itself
      if (!e.target.closest('.toggle-switch')) {
        toggleDarkMode();
      }
    });

    // Add keyboard support for accessibility
    modeSection.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleDarkMode();
      }
    });

    // Hero Image Loading Handler
    document.addEventListener('DOMContentLoaded', function() {
      const heroSection = document.querySelector('.hero-section');
      if (heroSection) {
        // Create a test image to check if hero image loads
        const testImg = new Image();
        testImg.onload = function() {
          // Image loaded successfully
          console.log('Hero image loaded successfully');
          heroSection.classList.add('image-loaded');
          heroSection.style.backgroundImage = 'url("{% static "images/hero.jpg" %}")';
        };
        testImg.onerror = function() {
          // Image failed to load, apply fallback styling
          console.log('Hero image failed to load');
          heroSection.classList.add('hero-section-fallback');
          heroSection.style.background = 'linear-gradient(135deg, var(--primary-color) 0%, var(--primary-color2) 100%)';
          heroSection.style.color = 'var(--text-color)';
        };
        testImg.src = '{% static "images/hero.jpg" %}';
        
        // Force apply image background immediately
        heroSection.style.backgroundImage = 'url("{% static "images/hero.jpg" %}")';
        heroSection.style.backgroundSize = 'cover';
        heroSection.style.backgroundPosition = 'center center';
        heroSection.style.backgroundRepeat = 'no-repeat';
      }
    });
  </script>

  {% block extra_js %}{% endblock %}

</body>
</html>
